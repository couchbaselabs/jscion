<html>
<head>
  <title>jscion</title>
</head>
<body>
<div id="container"></div>
<hr/>
<div id="identsByClass"></div>
<script src="js/underscore-1.5.2.min.js"></script>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/jscion.js"></script>
<script>
$(function() {
  $.ajax({
    url: "/data.json",
    dataType: "json",
    success: function(data) {
      var ctx = jsion(data);
      var r = ctx.renderIdent("invoice-0001");
      var h = r.err || r.result || "no render result";
      $("#container").html(h);
      dumpIdentsByClass(ctx, _.keys(data))
    }
  });
});

function dumpIdentsByClass(ctx, idents) {
  var classes = {};
  _.each(idents, function(ident) {
    var cname = (ctx.getObj(ident).result || {}).class || "<none>";
    var idents = classes[cname] || [];
    idents.push(ident);
    classes[cname] = idents;
  });
  var h = _.map(classes, function(idents, cname) {
    var supers = [];
    function fillSupers(cname) {
      if (cname) {
        supers.push(cname);
        fillSupers((ctx.getClassByName(cname).result || {}).super);
      }
    }
    fillSupers(cname);
    return "<li>[" + supers + "]:<ul><li>" + idents.join("</li><li>") + "</li></ul></li>";
  }).join("\n");
  $("#identsByClass").html("<ul>" + h + "</ul>");
}
</script>
</body>
</html>
